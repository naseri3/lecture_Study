<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>ë¹„ë™ê¸° í•™ìŠµ ì‹¤í—˜ì‹¤ (HTML+JS)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif; }
    body { margin: 24px; background:#f7f8fa; color:#222; }
    h1 { margin: 0 0 16px; }
    .lab { display:grid; gap:16px; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); }
    .card {
      background:#fff; border:1px solid #e5e7eb; border-radius:14px; padding:16px;
      box-shadow: 0 1px 2px rgba(0,0,0,.04);
    }
    .card h2 { font-size:18px; margin:0 0 10px; }
    button { padding:8px 12px; border-radius:10px; border:1px solid #d1d5db; background:#fff; cursor:pointer; }
    button:hover { background:#f3f4f6; }
    .row { display:flex; gap:8px; flex-wrap:wrap; margin:10px 0; }
    .log { background:#0b1020; color:#e2e8f0; padding:10px; border-radius:10px; min-height:72px; white-space:pre-wrap; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; }
    .ok { color:#22c55e; }
    .warn { color:#f59e0b; }
    .err { color:#ef4444; }
    .muted { color:#94a3b8; }
    .spinner { display:inline-block; width:1em; height:1em; border:.18em solid #cbd5e1; border-top-color:#475569; border-radius:50%; animation:spin 1s linear infinite; vertical-align:-.2em; }
    @keyframes spin { to { transform: rotate(360deg) } }
    .small { font-size:12px; color:#64748b; }
    code { background:#f1f5f9; padding:.1em .35em; border-radius:6px; }
  </style>
</head>
<body>
  <h1>ë¹„ë™ê¸° í•™ìŠµ ì‹¤í—˜ì‹¤</h1>
  <p class="small">ì˜¤ëŠ˜ ëª©í‘œ: <code>setTimeout/setInterval</code> â†’ <code>Promise</code> â†’ <code>async/await</code> â†’ <code>fetch + ì—ëŸ¬ ì²˜ë¦¬</code> â†’ <code>AbortController</code></p>

  <div class="lab">

    <!-- 1. setTimeout / setInterval -->
    <section class="card" id="timerCard">
      <h2>1) setTimeout / setInterval</h2>
      <p class="small">ì§€ì—° ì‹¤í–‰ê³¼ ë°˜ë³µ ì‹¤í–‰ì„ ì´í•´í•´ë³´ì.</p>
      <div class="row">
        <button id="btnTimeout">3ì´ˆ ë’¤ ë©”ì‹œì§€</button>
        <button id="btnIntervalStart">1ì´ˆ ê°„ê²© ì¹´ìš´íŠ¸ ì‹œì‘</button>
        <button id="btnIntervalStop">ì¹´ìš´íŠ¸ ì •ì§€</button>
      </div>
      <div class="log" id="timerLog"></div>
    </section>

    <!-- 2. Promise ê¸°ì´ˆ -->
    <section class="card" id="promiseCard">
      <h2>2) Promise ê¸°ì´ˆ (resolve / reject)</h2>
      <p class="small">ë¹„ë™ê¸° ì‘ì—…ì„ â€œì•½ì†(ìƒíƒœ)â€ ê°ì²´ë¡œ ë‹¤ë£¨ê¸°</p>
      <div class="row">
        <button id="btnPromiseResolve">ì„±ê³µ ì•½ì†</button>
        <button id="btnPromiseReject">ì‹¤íŒ¨ ì•½ì†</button>
      </div>
      <div class="log" id="promiseLog"></div>
    </section>

    <!-- 3. async/await + try/catch/finally -->
    <section class="card" id="asyncCard">
      <h2>3) async/await + try/catch/finally</h2>
      <p class="small"><code>await</code>ë¡œ ë™ê¸°ì²˜ëŸ¼ ì½íˆê²Œ, ì˜ˆì™¸ëŠ” <code>try/catch</code>ë¡œ!</p>
      <div class="row">
        <button id="btnAsyncOk">ì„±ê³µ ì‹œë‚˜ë¦¬ì˜¤</button>
        <button id="btnAsyncErr">ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤</button>
      </div>
      <div class="log" id="asyncLog"></div>
    </section>

    <!-- 4. fetch GET + ë¡œë”©/ì—ëŸ¬ UI -->
    <section class="card" id="fetchCard">
      <h2>4) fetch GET + ë¡œë”©/ì—ëŸ¬ UI</h2>
      <p class="small">ê³µê°œ API(JSONPlaceholder) ì‚¬ìš©. CORS í—ˆìš©, í‚¤ ë¶ˆí•„ìš”.</p>
      <div class="row">
        <button id="btnFetchOne">í•  ì¼ í•˜ë‚˜ ê°€ì ¸ì˜¤ê¸°</button>
        <button id="btnFetchUsers">ìœ ì € 3ëª… ë³‘ë ¬ ê°€ì ¸ì˜¤ê¸°</button>
      </div>
      <div class="log" id="fetchLog"></div>
    </section>

    <!-- 5. fetch POST + JSON ë°”ë”” -->
    <section class="card" id="postCard">
      <h2>5) fetch POST + JSON ë°”ë””</h2>
      <p class="small">ì„œë²„ë¡œ ë°ì´í„° ì „ì†¡(ì‹¤ì œ ì €ì¥ì€ ì•ˆë˜ì§€ë§Œ ì‘ë‹µì„ ë°˜í™˜í•¨)</p>
      <div class="row">
        <button id="btnPost">ê°€ì§œ TODO ìƒì„±(POST)</button>
      </div>
      <div class="log" id="postLog"></div>
    </section>

    <!-- 6. AbortController(íƒ€ì„ì•„ì›ƒ) + Promise.race -->
    <section class="card" id="abortCard">
      <h2>6) AbortControllerë¡œ íƒ€ì„ì•„ì›ƒ ê±¸ê¸°</h2>
      <p class="small"><code>fetch</code>ê°€ ë„ˆë¬´ ì˜¤ë˜ ê±¸ë¦¬ë©´ ì·¨ì†Œ(UX ì•ˆì •ì„±â†‘)</p>
      <div class="row">
        <button id="btnFetchTimeout">2ì´ˆ íƒ€ì„ì•„ì›ƒ ìš”ì²­</button>
      </div>
      <div class="log" id="abortLog"></div>
    </section>

  </div>

  <script>
    // ë„ìš°ë¯¸ë“¤
    const now = () => new Date().toLocaleTimeString();
    const sleep = (ms) => new Promise(res => setTimeout(res, ms));
    const logLine = (el, msg, cls="") => {
      const line = document.createElement("div");
      if (cls) line.className = cls;
      line.textContent = `[${now()}] ${msg}`;
      el.appendChild(line);
      el.scrollTop = el.scrollHeight;
    };

    // 1) setTimeout / setInterval
    (() => {
      const log = document.getElementById("timerLog");
      const btnTimeout = document.getElementById("btnTimeout");
      const btnIntervalStart = document.getElementById("btnIntervalStart");
      const btnIntervalStop = document.getElementById("btnIntervalStop");
      let intervalId = null;
      
      btnTimeout.addEventListener("click", () => {
        logLine(log, "3ì´ˆ ë’¤ì— ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì¤„ê²Œìš”â€¦", "muted");
        setTimeout(() => {
          logLine(log, "setTimeout: 3ì´ˆ ê²½ê³¼! ğŸ‰", "ok");
        }, 3000);
      });

      btnIntervalStart.addEventListener("click", () => {
        if (intervalId) return logLine(log, "ì´ë¯¸ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤.", "warn");
        let count = 0;
        intervalId = setInterval(() => {
          count++;
          logLine(log, `setInterval: ${count}ì´ˆ ê²½ê³¼`, "muted");
        }, 1000);
        logLine(log, "ì¹´ìš´íŠ¸ ì‹œì‘!", "ok");
      });

      btnIntervalStop.addEventListener("click", () => {
        if (!intervalId) return logLine(log, "ì‹¤í–‰ ì¤‘ì¸ ì¹´ìš´íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.", "warn");
        clearInterval(intervalId);
        intervalId = null;
        logLine(log, "ì¹´ìš´íŠ¸ ì •ì§€!", "ok");
      });
    })();

    // 2) Promise ê¸°ì´ˆ
    (() => {
      const log = document.getElementById("promiseLog");
      const okBtn = document.getElementById("btnPromiseResolve");
      const errBtn = document.getElementById("btnPromiseReject");

      function fakeJob(shouldResolve = true, delay = 1000) {
        return new Promise((resolve, reject) => {
          setTimeout(() => {
            shouldResolve ? resolve("ì‘ì—… ì„±ê³µ!") : reject(new Error("ì‘ì—… ì‹¤íŒ¨!"));
          }, delay);
        });
      }

      okBtn.addEventListener("click", () => {
        logLine(log, "ì„±ê³µ ì•½ì† ì‹œì‘â€¦", "muted");
        fakeJob(true, 800)
          .then(msg => {
            logLine(log, `then: ${msg}`, "ok");
            return "ì²´ì´ë‹ ë°ì´í„°";
          })
          .then(next => logLine(log, `then 2: ${next}`, "ok"))
          .catch(err => logLine(log, `catch: ${err.message}`, "err"))
          .finally(() => logLine(log, "finally: ì •ë¦¬ ì™„ë£Œ", "muted"));
      });

      errBtn.addEventListener("click", () => {
        logLine(log, "ì‹¤íŒ¨ ì•½ì† ì‹œì‘â€¦", "muted");
        fakeJob(false, 800)
          .then(msg => logLine(log, `then: ${msg}`, "ok"))
          .catch(err => logLine(log, `catch: ${err.message}`, "err"))
          .finally(() => logLine(log, "finally: ì •ë¦¬ ì™„ë£Œ", "muted"));
      });
    })();

    // 3) async/await + try/catch/finally
    (() => {
      const log = document.getElementById("asyncLog");
      const ok = document.getElementById("btnAsyncOk");
      const err = document.getElementById("btnAsyncErr");

      function asyncJob(shouldOk = true, delay = 700) {
        return new Promise((resolve, reject) => {
          setTimeout(() => {
            shouldOk ? resolve({ ok:true, value:42 }) : reject(new Error("ê³ ì˜ ì—ëŸ¬"));
          }, delay);
        });
      }

      ok.addEventListener("click", async () => {
        logLine(log, "async ì‹œì‘(ì„±ê³µ)â€¦", "muted");
        try {
          const a = await asyncJob(true);
          logLine(log, `1ë‹¨ê³„ ok: ${JSON.stringify(a)}`, "ok");
          const b = await asyncJob(true);
          logLine(log, `2ë‹¨ê³„ ok: ${JSON.stringify(b)}`, "ok");
        } catch (e) {
          logLine(log, `catch: ${e.message}`, "err");
        } finally {
          logLine(log, "finally: í•­ìƒ ì‹¤í–‰", "muted");
        }
      });

      err.addEventListener("click", async () => {
        logLine(log, "async ì‹œì‘(ì‹¤íŒ¨)â€¦", "muted");
        try {
          await asyncJob(false);
          logLine(log, "ì´ ì¤„ì€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ", "warn");
        } catch (e) {
          logLine(log, `catch: ${e.message}`, "err");
        } finally {
          logLine(log, "finally: ì •ë¦¬", "muted");
        }
      });
    })();

    // 4) fetch GET + ë¡œë”©/ì—ëŸ¬
    (() => {
      const log = document.getElementById("fetchLog");
      const btnOne = document.getElementById("btnFetchOne");
      const btnUsers = document.getElementById("btnFetchUsers");

      const withLoading = async (fn) => {
        const s = document.createElement("span");
        s.className = "spinner";
        log.appendChild(s);
        logLine(log, " ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì¤‘â€¦", "muted");
        try { return await fn(); }
        finally { s.remove(); }
      };

      btnOne.addEventListener("click", async () => {
        await withLoading(async () => {
          try {
            const res = await fetch("https://jsonplaceholder.typicode.com/todos/1");
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            const data = await res.json();
            logLine(log, `ì œëª©: ${data.title} (ì™„ë£Œ:${data.completed})`, "ok");
          } catch (e) {
            logLine(log, `ì—ëŸ¬: ${e.message}`, "err");
          }
        });
      });

      btnUsers.addEventListener("click", async () => {
        await withLoading(async () => {
          try {
            const ids = [1, 2, 3];
            const tasks = ids.map(id =>
              fetch(`https://jsonplaceholder.typicode.com/users/${id}`).then(r => r.json())
            );
            const results = await Promise.allSettled(tasks);
            results.forEach((r, i) => {
              if (r.status === "fulfilled") {
                logLine(log, `ìœ ì €${ids[i]}: ${r.value.name} / ${r.value.email}`, "ok");
              } else {
                logLine(log, `ìœ ì €${ids[i]} ì‹¤íŒ¨: ${r.reason}`, "err");
              }
            });
          } catch (e) {
            logLine(log, `ì „ì²´ ì—ëŸ¬: ${e.message}`, "err");
          }
        });
      });
    })();

    // 5) fetch POST + JSON
    (() => {
      const log = document.getElementById("postLog");
      const btn = document.getElementById("btnPost");

      btn.addEventListener("click", async () => {
        try {
          logLine(log, "POST ìš”ì²­â€¦", "muted");
          const res = await fetch("https://jsonplaceholder.typicode.com/posts", {
            method: "POST",
            headers: { "Content-Type": "application/json; charset=utf-8" },
            body: JSON.stringify({
              title: "APTJOB ì‹¤í—˜ìš©",
              body: "ë¹„ë™ê¸° POST ì˜ˆì œ",
              userId: 123,
            }),
          });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const data = await res.json();
          logLine(log, `ì‘ë‹µ id=${data.id}, title="${data.title}"`, "ok");
        } catch (e) {
          logLine(log, `ì—ëŸ¬: ${e.message}`, "err");
        }
      });
    })();

    // 6) AbortController + íƒ€ì„ì•„ì›ƒ
    (() => {
      const log = document.getElementById("abortLog");
      const btn = document.getElementById("btnFetchTimeout");

      function fetchWithTimeout(url, ms = 2000) {
        const controller = new AbortController();
        const id = setTimeout(() => controller.abort(), ms);
        return fetch(url, { signal: controller.signal })
          .finally(() => clearTimeout(id));
      }

      btn.addEventListener("click", async () => {
        logLine(log, "2ì´ˆ íƒ€ì„ì•„ì›ƒìœ¼ë¡œ ìš”ì²­ ì‹œì‘â€¦", "muted");
        try {
          // ëŠë¦° APIê°€ ì•„ë‹ˆë¯€ë¡œ ì •ìƒì ìœ¼ë¡œ ì„±ê³µí•  ê°€ëŠ¥ì„±ì´ ë†’ë‹¤.
          // íƒ€ì„ì•„ì›ƒ ë™ì‘ì„ ë³´ë ¤ë©´ msë¥¼ 1ë¡œ ì¤„ì—¬ë³´ê³  í…ŒìŠ¤íŠ¸í•´ë„ ë¨.
          const res = await fetchWithTimeout("https://jsonplaceholder.typicode.com/todos/2", 2000);
          const data = await res.json();
          logLine(log, `ì„±ê³µ: ${data.title}`, "ok");
        } catch (e) {
          if (e.name === "AbortError") {
            logLine(log, "ìš”ì²­ì´ íƒ€ì„ì•„ì›ƒë˜ì–´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.", "warn");
          } else {
            logLine(log, `ì—ëŸ¬: ${e.message}`, "err");
          }
        }
      });
    })();
  </script>
</body>
</html>
